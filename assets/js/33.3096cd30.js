(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{475:function(t,a,s){"use strict";s.r(a);var e=s(22),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"gitlab-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci"}},[t._v("#")]),t._v(" Gitlab-CI")]),t._v(" "),s("h2",{attrs:{id:"ä»‹ç»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»"}},[t._v("#")]),t._v(" ä»‹ç»")]),t._v(" "),s("p",[t._v("Gitlab CI/CD æ˜¯ä¸€æ¬¾ç”¨äº"),s("a",{attrs:{href:"https://github.com/ascoders/weekly/blob/v2/101.%E7%B2%BE%E8%AF%BB%E3%80%8A%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%20vs%20%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98%20vs%20%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2%E3%80%8B.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("æŒç»­é›†æˆï¼ˆCIï¼‰ï¼ŒæŒç»­äº¤ä»˜ï¼ˆCDï¼‰"),s("OutboundLink")],1),t._v("çš„å·¥å…·ï¼Œç›¸ä¼¼çš„å·¥å…·æœ‰ Jenkinsã€Travis CIã€GoCD ç­‰ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("CI å³æŒç»­é›†æˆï¼ŒContinuous Integrationï¼Œç›®æ ‡ï¼šæŒç»­é›†æˆï¼ŒæŒç»­æµ‹è¯•ï¼ˆä¿è¯ä»£ç è´¨é‡ï¼‰")]),t._v(" "),s("li",[t._v("CD å³æŒç»­äº¤ä»˜ï¼Œå³ Continuous Deliveryï¼Œç›®æ ‡:Â  æŒç»­éƒ¨ç½²ï¼ˆè‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬ï¼Œä¾›ç”¨æˆ·ä½¿ç”¨)ã€‚")]),t._v(" "),s("li",[t._v("ä» GitLab 8.0 å¼€å§‹ï¼ŒGitLab CI å°±å·²ç»é›†æˆåœ¨ GitLab ä¸­ï¼Œæˆ‘ä»¬åªè¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª .gitlab-ci.yml æ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä¸€ä¸ª Runnerï¼Œå³å¯è¿›è¡ŒæŒç»­é›†æˆã€‚")]),t._v(" "),s("li",[t._v(".gitlab-ci.yml æ–‡ä»¶ä½¿ç”¨ yaml è¯­æ³•ï¼Œ"),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/07/yaml.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¯­æ³•ä»‹ç»è¯·æˆ³"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("ä¸ jenkins å¯¹æ¯”")]),t._v(" "),s("ul",[s("li",[t._v("gitlab-ci çš„ä¼˜åŠ¿åœ¨äºæ¯”è¾ƒé…ç½®å’Œä½¿ç”¨ç®€å•ï¼Œèƒ½åœ¨ gitlab ä¸Šç›´æ¥çœ‹åˆ°æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸éœ€è¦é… webhookï¼Œé›†æˆåœ¨äº† gitlab ä¸Šã€‚")]),t._v(" "),s("li",[t._v("jenkins çš„ä¼˜åŠ¿åœ¨äºç¼–è¯‘æœåŠ¡å’Œä»£ç ä»“åº“åˆ†ç¦»ï¼Œè€Œä¸”ç¼–è¯‘é…ç½®æ–‡ä»¶ä¸éœ€è¦åœ¨å·¥ç¨‹ä¸­é…ç½®ï¼Œå¹¶ä¸” jenkins ä¾é å®ƒä¸°å¯Œçš„æ’ä»¶ï¼Œå¯ä»¥é…ç½®å¾ˆå¤š gitlab-ci ä¸å­˜åœ¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´çœ‹ç¼–è¯‘çŠ¶å†µç»Ÿè®¡ç­‰")])]),t._v(" "),s("h2",{attrs:{id:"gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-runner"}},[t._v("#")]),t._v(" gitlab-runner")]),t._v(" "),s("ul",[s("li",[t._v("gitlab çš„è‡ªåŠ¨åŒ–æ“ä½œéƒ½æ˜¯åœ¨ runner æœºå™¨ä¸­è¿è¡Œ,æˆ‘ä»¬éœ€è¦æ³¨å†Œ runner")]),t._v(" "),s("li",[t._v("runner åˆ†ä¸º shared runner å’Œ specified runner.")])]),t._v(" "),s("h3",{attrs:{id:"gitlab-æ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-æ“ä½œ"}},[t._v("#")]),t._v(" gitlab æ“ä½œ")]),t._v(" "),s("p",[t._v("gitlab ä¸Šæœ‰å…³ gitlab-ci çš„é…ç½®æœ‰ä¸¤å¤„")]),t._v(" "),s("ul",[s("li",[t._v("ä¸€å¤„æ˜¯ CI/CD å¯ä»¥æŸ¥çœ‹æ„å»ºä»»åŠ¡ pipelineã€job çš„æ‰§è¡Œæƒ…å†µ")]),t._v(" "),s("li",[t._v("ä¸€å¤„æ˜¯ setting é‡Œé¢å¯¹ ci çš„è®¾ç½®")])]),t._v(" "),s("img",{attrs:{src:"https://i.loli.net/2020/12/12/IVjWRdYUlOKbCsn.png",alt:"image-20201212122028807"}}),t._v(" "),s("ul",[s("li",[s("p",[t._v("ä¸€æ¬¡æäº¤è§¦å‘ä¸€æ¬¡ CI&CD å³æ‰§è¡Œä¸€æ¬¡è„šæœ¬å¯¹åº”ä¸€ä¸ª pipeline")])]),t._v(" "),s("li",[s("p",[t._v("ä¸€ä¸ª pipeline å¯¹åº” stages ä¸‹çš„æ‰€æœ‰ job")])]),t._v(" "),s("li",[s("p",[t._v("ä¸€ä¸ª stage å¯ä»¥æœ‰å¤šä¸ª jobï¼›")])])]),t._v(" "),s("h3",{attrs:{id:"skip-pipeline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skip-pipeline"}},[t._v("#")]),t._v(" Skip Pipeline")]),t._v(" "),s("ul",[s("li",[t._v("commit message ä¸ŠåŠ ä¸Š[ci skip]Â  æˆ–è€…[skip ci]å°±å¯ä»¥è·³è¿‡ pipeline æ‰§è¡Œã€‚")]),t._v(" "),s("li",[t._v("åœ¨ä¸€æ¬¡ git push è°ƒç”¨ä¸­è¿›è¡Œå¤šæ¬¡æ›´æ”¹æ—¶ï¼ŒGitLab æœ€å¤šåˆ›å»ºå››ä¸ªåˆ†æ”¯å’Œæ ‡ç­¾ç®¡é“ã€‚æ­¤é™åˆ¶ä¸å½±å“ä»»ä½•æ›´æ–°çš„åˆå¹¶è¯·æ±‚ç®¡é“ã€‚æ‰€æœ‰æ›´æ–°çš„åˆå¹¶è¯·æ±‚åœ¨ä½¿ç”¨ç®¡é“å¤„ç†åˆå¹¶è¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªç®¡é“ã€‚")])]),t._v(" "),s("h2",{attrs:{id:"stages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stages"}},[t._v("#")]),t._v(" stages")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("gitlab-ci çš„ pipeline ç”±ä¸€ä¸ªä¸ª stage é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ª stage å¯ä»¥æœ‰å¤šä¸ª job")])]),t._v(" "),s("li",[s("p",[t._v("job æ˜¯å¹¶è¡Œæ‰§è¡Œçš„\næ‰€æœ‰ build çš„ jobs æ‰§è¡ŒæˆåŠŸåï¼Œcommit æ‰ä¼šæ ‡è®°ä¸º successï¼Œæ‰€æœ‰çš„ build çš„ jobs æ‰§è¡ŒæˆåŠŸï¼Œ")])]),t._v(" "),s("li",[s("p",[t._v("ä»»ä½•ä¸€ä¸ªå‰ç½®çš„ jobs å¤±è´¥äº†ï¼Œcommit ä¼šæ ‡è®°ä¸º failed å¹¶ä¸”ä¸‹ä¸€ä¸ª stages çš„ jobs éƒ½ä¸ä¼šæ‰§è¡Œã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é»˜è®¤å®šä¹‰ä¸º buildï¼Œtest å’Œ deployã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœä¸€ä¸ª job æ²¡æœ‰æŒ‡å®š stageï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡ä¼šåˆ†é…åˆ° test stageã€‚")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" release_deploy\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" prod_deploy\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"jobs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jobs"}},[t._v("#")]),t._v(" Jobs")]),t._v(" "),s("ul",[s("li",[t._v(".gitlab-ci.yml å…è®¸æŒ‡å®šæ— é™é‡ jobsã€‚")]),t._v(" "),s("li",[t._v("æ¯ä¸ª jobs å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œè€Œä¸”ä¸èƒ½æ˜¯ä¸Šé¢æåˆ°çš„å…³é”®å­—ã€‚")]),t._v(" "),s("li",[t._v("job ç”±ä¸€åˆ—å‚æ•°æ¥å®šä¹‰ jobs çš„è¡Œä¸ºã€‚")]),t._v(" "),s("li",[t._v("æ‰€å±åŒä¸€ä¸ª stage çš„ job éƒ½æ˜¯å¹¶è¡Œçš„")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("job_name:\n")])])]),s("h3",{attrs:{id:"pages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pages"}},[t._v("#")]),t._v(" pages")]),t._v(" "),s("p",[t._v("ä¸€ä¸ªç‰¹æ®Šçš„ jobï¼Œç”¨äºä¸Šä¼ é™æ€å†…å®¹åˆ° GitLabï¼Œå¯ç”¨äºæœåŠ¡äºæ‚¨çš„ç½‘ç«™ã€‚éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶")]),t._v(" "),s("ul",[s("li",[t._v("ä»»ä½•é™æ€å†…å®¹éƒ½å¿…é¡»æ”¾åœ¨"),s("code",[t._v("public/")]),t._v(" directory. ç›®å½•")]),t._v(" "),s("li",[s("code",[t._v("artifacts")]),t._v(" ï¼špath ï¼š"),s("code",[t._v("public/")]),t._v(" ç›®å½•å¿…é¡»æœ‰")])]),t._v(" "),s("p",[t._v("ä¸‹é¢çš„ç¤ºä¾‹åªæ˜¯å°†æ‰€æœ‰æ–‡ä»¶ä»é¡¹ç›®çš„æ ¹ç›®å½•ç§»åŠ¨åˆ° public/ç›®å½•")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mkdir .public\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r * .public\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mv .public public\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¿…é¡»æœ‰")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n")])])]),s("h3",{attrs:{id:"script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#script"}},[t._v("#")]),t._v(" script")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('script:\n\t- echo "ğŸ“¦ å¼€å§‹æ‰“åŒ…"\n\t- ssh xxx@xxxxxx "\n        rm -rf \\`ls -d /xxx/www/* | grep -v -E \'\\.tar\\.gz$\'\\` &&\n        cd /xxx/www &&\n        tar xvzf ${PKG_NAME} &&\n        rm ${PKG_NAME}"\n     # é•¿å‘½ä»¤å¯ä»¥é€šè¿‡å¼•å·åŒ…è£¹ï¼Œå†ç”¨&&è¿æ¥è¡¨ç¤ºé¡ºåºæ‰§è¡Œå‘½ä»¤\n')])])]),s("h3",{attrs:{id:"å˜é‡-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡-variables"}},[t._v("#")]),t._v(" å˜é‡ï¼švariables")]),t._v(" "),s("p",[t._v("å˜é‡å¯ä»¥è¢«è¦†ç›–ï¼Œå¹¶ä¸”æ˜¯æŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§ä¾æ¬¡é™ä½")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/triggers/README.html#making-use-of-trigger-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("Trigger variables"),s("OutboundLink")],1),t._v(", "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/pipelines/schedules.html#using-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("scheduled pipeline variables"),s("OutboundLink")],1),t._v(", and "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#override-a-variable-by-manually-running-a-pipeline",target:"_blank",rel:"noopener noreferrer"}},[t._v("manual pipeline run variables"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("li",[t._v("Project-level "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#custom-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("variables"),s("OutboundLink")],1),t._v(" or "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#protect-a-custom-variable",target:"_blank",rel:"noopener noreferrer"}},[t._v("protected variables"),s("OutboundLink")],1),t._v(". é¡¹ç›® CI è®¾ç½®çš„å˜é‡")]),t._v(" "),s("li",[t._v("Group-level "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#group-level-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("variables"),s("OutboundLink")],1),t._v(" or "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#protect-a-custom-variable",target:"_blank",rel:"noopener noreferrer"}},[t._v("protected variables"),s("OutboundLink")],1),t._v(". gitlab åˆ†ç»„ä¸‹ CI è®¾ç½®çš„å˜é‡")]),t._v(" "),s("li",[t._v("Instance-level "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#instance-level-cicd-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("variables"),s("OutboundLink")],1),t._v(" or "),s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#protect-a-custom-variable",target:"_blank",rel:"noopener noreferrer"}},[t._v("protected variables"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#inherit-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("Inherited environment variables"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/yaml/README.html#job-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("YAML å®šä¹‰çš„ job çº§åˆ«å˜é‡"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/yaml/README.html#variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("YAML å®šä¹‰çš„å…¨å±€å˜é‡"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#deployment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("éƒ¨ç½²ç¯å¢ƒå˜é‡"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ce/ci/variables/README.html#predefined-variables-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("é¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡"),s("OutboundLink")],1),t._v(" (ä¼˜å…ˆçº§æœ€ä½)")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("variables"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BUSINESS_LINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BUSINESS_LINE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"job-çš„æ‰§è¡Œæ¡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#job-çš„æ‰§è¡Œæ¡ä»¶"}},[t._v("#")]),t._v(" job çš„æ‰§è¡Œæ¡ä»¶")]),t._v(" "),s("p",[t._v("onlyï¼ˆå®šä¹‰ job æ‰§è¡Œæ¡ä»¶ï¼‰å’Œ exceptï¼ˆå®šä¹‰äº† job ä¸è¢«æ‰§è¡Œçš„æ¡ä»¶ï¼‰ä¸¤ä¸ªå‚æ•°å®šä¹‰äº† job è¢«åˆ›å»ºçš„æ¡ä»¶:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("except å’Œ only å¦‚æœæ²¡æœ‰æŒ‡å®š nameï¼Œé»˜è®¤æ˜¯ tags å’Œ branches")])]),t._v(" "),s("li",[s("p",[t._v("only å’Œ except å¦‚æœéƒ½å­˜åœ¨åœ¨ä¸€ä¸ª job å£°æ˜ä¸­ï¼Œåˆ™æ‰€éœ€å¼•ç”¨å°†ä¼šè¢« only å’Œ except æ‰€å®šä¹‰çš„åˆ†æ”¯è¿‡æ»¤.")])]),t._v(" "),s("li",[s("p",[t._v("only å’Œ except å…è®¸ä½¿ç”¨æ­£åˆ™")])]),t._v(" "),s("li",[s("p",[t._v("only å’Œ except å…è®¸ä½¿ç”¨æŒ‡å®šä»“åº“åœ°å€ï¼Œä½†æ˜¯ä¸ forks ä»“åº“")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#éƒ½æ˜¯æˆ–è€…çš„å…³ç³»")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" tags      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tag åˆ†æ”¯ commit ä¹‹åè§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" triggers  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# API è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å½“ä½ çš„Git Refså¯¹åº”çš„æ˜¯ä¸€ä¸ªåˆ†æ”¯æ—¶è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" tags      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å½“ä½ çš„Git Refså¯¹åº”çš„æ˜¯ä¸€ä¸ªæ ‡ç­¾æ—¶è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pushes    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å½“ä½ ä½¿ç”¨git pushæ—¶è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å½“ä½ ä½¿ç”¨Webç•Œé¢çš„Run Pipelineæ—¶è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" merge_requests "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å½“ä½ åˆ›å»ºæˆ–è€…æ›´æ–°ä¸€ä¸ªmerge_requestsæ—¶è§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" schedules "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ¯æ—¥æ„å»ºè§¦å‘")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /^issue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("."),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*$/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# jobå°†ä¼šåªåœ¨issue-å¼€å¤´çš„refsä¸‹æ‰§è¡Œ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" branches@gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("org/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#åœ¨çˆ¶ä»“åº“gitlab-org/    gitlab-ceæœ‰æäº¤æ—¶è¿è¡Œã€‚")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¯¹åˆ†æ”¯çš„é™åˆ¶è§¦å‘,åªåœ¨åˆ†æ”¯æ˜¯masterå’Œschedulesçš„æ—¶å€™è§¦å‘")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("refs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" schedules\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" active\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å˜é‡æ¡ä»¶è§¦å‘ï¼Œå½“RELEASEå˜é‡æ˜¯stagingæˆ–è€…STAGINGå­˜åœ¨æ—¶è§¦å‘")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("variables")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' $RELEASE == "staging"\n      '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $STAGING\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' ($CI_COMMIT_BRANCH == "master" '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(' $CI_COMMIT_BRANCH == "develop") '),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(" $MY_VARIABLE\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ–‡ä»¶å˜åŒ–æ‰è§¦å‘")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("changes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Dockerfile\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker/scripts/*\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dockerfiles/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**/*")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" more_scripts/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("rb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_PIPELINE_SOURCE == \"merge_request_event\"'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow_failure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_PIPELINE_SOURCE == \"schedule\"'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ($CI_COMMIT_BRANCH == "master" '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(' $CI_COMMIT_BRANCH == "develop") '),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(" $MY_VARIABLE\n")])])]),s("p",[s("img",{attrs:{src:"https://i.loli.net/2020/12/13/TKO5iznorx2Vv46.png",alt:"image-20201213200855935"}})]),t._v(" "),s("h3",{attrs:{id:"image-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#image-services"}},[t._v("#")]),t._v(" image/services")]),t._v(" "),s("p",[t._v("è¯¥å…³é”®å­—æŒ‡å®šä¸€ä¸ªä»»åŠ¡ï¼ˆjobï¼‰æ‰€ä½¿ç”¨çš„ docker é•œåƒï¼Œä¾‹å¦‚"),s("code",[t._v("image: python:latest")]),t._v("ä½¿ç”¨ Python çš„æœ€æ–°é•œåƒã€‚")]),t._v(" "),s("p",[t._v("é•œåƒä¸‹è½½çš„ç­–ç•¥ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("neverï¼š å½“ä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œä¼šç¦æ­¢ Gitlab Runner ä» Docker hub æˆ–è€…å…¶ä»–åœ°æ–¹ä¸‹æ‹‰é•œåƒï¼Œåªèƒ½ä½¿ç”¨è‡ªå·±æ‰‹åŠ¨ä¸‹æ‹‰çš„é•œåƒ")]),t._v(" "),s("li",[t._v("if-not-presentï¼š å½“ä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼ŒRunner ä¼šå…ˆæ£€æµ‹æœ¬åœ°æ˜¯å¦æœ‰é•œåƒï¼Œæœ‰çš„è¯ä½¿ç”¨è¯¥é•œåƒï¼Œå¦‚æœæ²¡æœ‰å†å»ä¸‹æ‹‰ã€‚è¿™ä¸ªç­–ç•¥å¦‚æœå†é…åˆå®šæœŸåˆ é™¤é•œåƒï¼Œå°±èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚")]),t._v(" "),s("li",[t._v("alwaysï¼š è¿™ä¸ªæ˜¯ gitlab-ci é»˜è®¤ä½¿ç”¨çš„ç­–ç•¥ï¼Œå³æ¯ä¸€æ¬¡éƒ½æ˜¯é‡æ–°ä¸‹æ‹‰é•œåƒï¼Œå¯¼è‡´çš„ç»“æœå°±æ˜¯æ¯”è¾ƒè€—æ—¶é—´")])]),t._v(" "),s("h3",{attrs:{id:"artifacts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#artifacts"}},[t._v("#")]),t._v(" artifacts")]),t._v(" "),s("p",[t._v("artifacts è¢«ç”¨äºåœ¨ job ä½œä¸šæˆåŠŸåå°†åˆ¶å®šåˆ—è¡¨é‡Œçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹é™„åŠ åˆ° job ä¸Šï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ª job ï¼Œå¦‚æœè¦åœ¨ä¸¤ä¸ª job ä¹‹é—´ä¼ é€’ artifactsï¼Œä½ å¿…é¡»è®¾ç½® dependencies,ä¸‹é¢æœ‰å‡ ä¸ªä¾‹å­")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$CI_JOB_NAME"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# artifactså‹ç¼©åŒ…é‡å‘½å")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("untracked")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¼ é€’æ‰€æœ‰gitæ²¡æœ‰è¿½è¸ªçš„æ–‡ä»¶")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" on_failure "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å½“jobæ‰§è¡Œå¤±è´¥æ—¶ï¼Œä¸Šä¼ artifacts,è¿˜æœ‰on_success è¿™ä¸ªå€¼æ˜¯é»˜è®¤çš„ï¼Œå½“jobæˆåŠŸæ—¶ä¸Šä¼ artifactsã€‚always ä¸ç®¡å¤±è´¥ä¸å¦ï¼Œéƒ½ä¸Šä¼ ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" expire_in "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è®¾ç½® artifacts ä¸Šä¼ åŒ…çš„å¤±æ•ˆæ—¶é—´. å¦‚æœä¸è®¾ç½®ï¼Œartifacts çš„æ‰“åŒ…æ˜¯æ°¸è¿œå­˜åœ¨äº gitlabä¸Š çš„ï¼Œ'3 mins 4 sec','2 hrs 20 min','2h20min','6 mos 1 day','47 yrs 6 mos and 4d','3 weeks and 2 days'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" binaries/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ä¼ é€’æ‰€æœ‰binarieså’Œ.configï¼š")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" .config\n")])])]),s("h2",{attrs:{id:"å‚è€ƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[t._v("#")]),t._v(" å‚è€ƒ")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/6844904045581172744#heading-11",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlab-CI ä½¿ç”¨æ•™ç¨‹"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/README.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlab-ci-å®˜æ–¹æ–‡æ¡£"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);