(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{513:function(t,s,a){"use strict";a.r(s);var n=a(22),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"模块化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块化"}},[t._v("#")]),t._v(" 模块化")]),t._v(" "),a("ul",[a("li",[t._v("ES6 模块，简称 ESM\n"),a("ul",[a("li",[t._v('mjs 文件总是以 ES6 模块加载，.js 文件的加载取决于 package.json 里面 type 字段的设置。如果加了"type": "module"，则代表该项目使用 esm 模块解析')])])]),t._v(" "),a("li",[t._v("Node.js 专用的 CommonJS 模块，简称 CJS\n"),a("ul",[a("li",[t._v(".cjs 文件总是以 CommonJS 模块加载")])])])]),t._v(" "),a("h2",{attrs:{id:"commonjs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commonjs"}},[t._v("#")]),t._v(" CommonJS")]),t._v(" "),a("p",[t._v("Node.js 是"),a("code",[t._v("commonJS")]),t._v("规范的主要实践者，它有四个重要的环境变量为模块化的实现提供支持："),a("code",[t._v("module、exports、require、global")]),t._v("。实际使用时，用"),a("code",[t._v("module.exports")]),t._v("定义当前模块对外输出的接口，用"),a("code",[t._v("require")]),t._v("加载模块。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义模块 area.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("radius")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PI")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" radius "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" radius"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在这里写上需要向外暴露的函数、变量")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  area"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" area\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引用自定义的模块时，参数包含路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" math "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./math"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("但是我们并没有直接定义 "),a("code",[t._v("module、exports、require")]),t._v("这些模块，以及 Node 的 API 文档中提到的"),a("code",[t._v("__filename、__dirname")]),t._v("。那么是从何而来呢？其实在编译的过程中，Node 对我们定义的 JS 模块进行了一次基础的包装：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这样我们便可以访问这些传入的"),a("code",[t._v("arguments")]),t._v("以及隔离了彼此的作用域。"),a("code",[t._v("CommonJS")]),t._v(" 的一个模块，就是一个脚本文件。"),a("code",[t._v("require")]),t._v("命令第一次加载该脚本，就会执行整个脚本，然后在内存生成一个对象。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  exports"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loaded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("首次加载后的模块会"),a("strong",[t._v("缓存")]),t._v("在 require.cache 之中,是对象的"),a("strong",[t._v("浅拷贝")]),t._v("，所以多次加载 require，得到的对象是同一个。")]),t._v(" "),a("p",[t._v("以后需要用到这个模块的时候，就会到"),a("code",[t._v("exports")]),t._v("属性上面取值。即使再次执行"),a("code",[t._v("require")]),t._v("命令，也不会再次执行该模块，而是到缓存之中取值。commonJS 用同步的方式加载模块，只有在代码执行到"),a("code",[t._v("require")]),t._v("的时候，才回去执行加载。")]),t._v(" "),a("p",[t._v("在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题。但是在浏览器端，限于网络原因，更合理的方案是使用异步加载。")]),t._v(" "),a("h3",{attrs:{id:"exports-和-module-exports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exports-和-module-exports"}},[t._v("#")]),t._v(" exports 和 module.exports")]),t._v(" "),a("ul",[a("li",[t._v("在一个 node 执行一个文件时，会给这个文件内生成一个 exports 和 module 对象，\n而 module 有一个 exports 属性。")]),t._v(" "),a("li",[t._v("exports 是 module.exports 的一个引用,作用相等\n"),a("ul",[a("li",[a("code",[t._v("exports = module.exports = {};")]),t._v("，辅助 module.exports 添加内容用的，尽量使用 module.exports ,以免因为各种赋值导致的混乱")])])])]),t._v(" "),a("h2",{attrs:{id:"esm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#esm"}},[t._v("#")]),t._v(" ESM")]),t._v(" "),a("p",[t._v("对于 ESM，在运行任何代码之前，你首先需要建立整个模块依赖的关系图。也就是说，建立关系图时变量是还没有值的，因为代码都还没运行。")]),t._v(" "),a("h3",{attrs:{id:"esm-原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#esm-原理"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000014318751",target:"_blank",rel:"noopener noreferrer"}},[t._v("esm 原理"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("一个模块的运行分为以下三步")]),t._v(" "),a("ul",[a("li",[t._v("构建\n"),a("ul",[a("li",[t._v("查找下载，然后把所有文件解析成模块记录")])])]),t._v(" "),a("li",[t._v("实例化\n"),a("ul",[a("li",[t._v("为每个模块记录分配内部所需的变量地址，以拥有状态")])])]),t._v(" "),a("li",[t._v("运行")])]),t._v(" "),a("p",[t._v("如何实现以上步骤")]),t._v(" "),a("ul",[a("li",[t._v("文件由加载器提取，（就是识别 esm 的方式）对于浏览器，标准是使用 html，type=module 的脚本，可由各个平台自定义")]),t._v(" "),a("li",[t._v("其他的步骤解析成模块记录和实例化和运行是由"),a("a",{attrs:{href:"https://tc39.es/ecma262/#sec-modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESM"),a("OutboundLink")],1),t._v("标准 规范")])]),t._v(" "),a("p",[t._v("ESM 和 CJS 之间最主要的区别之一就是，ESM 把算法化为为多个阶段。")]),t._v(" "),a("ul",[a("li",[t._v("浏览器下载文件会耗费大量时间，会阻塞主线程，将构建分为一个独立阶段后，浏览器可以在进入同步的实例话过程前下载文件，理解模块关系图")]),t._v(" "),a("li",[t._v("动态导入实际上是将 import() 加载的文件当成了一个入口文件。动态导入的模块会开启一个全新的独立依赖关系树")]),t._v(" "),a("li",[t._v("加载器使用模块映射（Module Map）来管理缓存。每个全局作用域都在一个单独的模块映射中跟踪其模块。")]),t._v(" "),a("li",[t._v("采用实时绑定，值引用，引擎可以在不运行任何模块代码的情况下完成链接（不需要再执行代码获取值）")])]),t._v(" "),a("h3",{attrs:{id:"import-maps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import-maps"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://beginor.github.io/2021/08/16/using-es-modules-in-borwser-with-importmaps.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("import-maps"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("通过 import-maps 可以让浏览器识别全局模块，")]),t._v(" "),a("li",[t._v("import-maps 使用 Json 的形式来定义浏览器中的全局模块")]),t._v(" "),a("li",[t._v("对于不支持 import-maps 的浏览器， 可以使用 es-module-shims 进行处理。")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("importmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"importmap"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://unpkg.com/browse/vue@3.2.2/dist/vue.runtime.esm-browser.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue-router"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://unpkg.com/browse/vue-router@4.0.11/dist/vue-router.esm-browser.js"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createApp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    template"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<div></div>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#root"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h2",{attrs:{id:"es6-模块与-commonjs-模块的差异"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es6-模块与-commonjs-模块的差异"}},[t._v("#")]),t._v(" ES6 模块与 CommonJS 模块的差异")]),t._v(" "),a("ul",[a("li",[t._v("CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用。")]),t._v(" "),a("li",[t._v("CommonJS 模块是运行时加载，ES6 模块是编译时输出接口。")]),t._v(" "),a("li",[t._v("CommonJS 模块的 require()是同步加载模块，ES6 模块的 import 命令是异步加载，有一个独立的模块依赖的解析阶段。")])]),t._v(" "),a("h3",{attrs:{id:"es-module-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es-module-总结"}},[t._v("#")]),t._v(" es module 总结")]),t._v(" "),a("ul",[a("li",[t._v("静态的，不能放在块级作用域内，代码发生在编译时。在代码执行前会")]),t._v(" "),a("li",[t._v("导入模块在"),a("strong",[t._v("严格模式")]),t._v("下。")]),t._v(" "),a("li",[t._v("esm 模块导出的常量是只读引用，如果尝试修改会报错")]),t._v(" "),a("li",[t._v("使用 esm 可以很容易实现 Tree Shaking 和 Code Splitting。")]),t._v(" "),a("li",[t._v("加载一个模块脚本时不需要使用 defer 属性 (see <script> attributes) 模块会自动延迟加载")]),t._v(" "),a("li",[t._v("执行顺序先子后父，采用深度优先的后序遍历的方式解析模块 tree")]),t._v(" "),a("li",[t._v("ES6 模块之中，顶层的 this 指向 undefined；CommonJS "),a("strong",[t._v("模块的顶层 this 指向当前模块")])])]),t._v(" "),a("h3",{attrs:{id:"循环加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环加载"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/navysummer/p/9689858.html#%E5%BE%AA%E7%8E%AF%E5%8A%A0%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("循环加载"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("commonJS 通过模块缓存的方式解决循环加载")]),t._v(" "),a("li",[t._v("ESM，先执行子模块代码，再回到父模块代码执行，如果子又引入了父模块，则认为父模块已经加载了，并且都是 undefined，如果是引入的函数，可以正常获得，因为函数声明提升")])]),t._v(" "),a("h2",{attrs:{id:"systemjs-是模块加载的-polyfill"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemjs-是模块加载的-polyfill"}},[t._v("#")]),t._v(" systemJS 是模块加载的 polyfill")]),t._v(" "),a("h2",{attrs:{id:"同时支持两种格式的模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同时支持两种格式的模块"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://es6.ruanyifeng.com/#docs/module-loader#%E5%90%8C%E6%97%B6%E6%94%AF%E6%8C%81%E4%B8%A4%E7%A7%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%A8%A1%E5%9D%97",target:"_blank",rel:"noopener noreferrer"}},[t._v("同时支持两种格式的模块"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/muwoo/blogs/issues/28",target:"_blank",rel:"noopener noreferrer"}},[t._v("CommonJS、AMD/CMD、ES6 Modules 以及 webpack 原理浅析"),a("OutboundLink")],1),t._v(" .")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.html.cn/archives/6974",target:"_blank",rel:"noopener noreferrer"}},[t._v("ES6 Modules(模块)系统及语法详解"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000014318751",target:"_blank",rel:"noopener noreferrer"}},[t._v("esm 原理"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);