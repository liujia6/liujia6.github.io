# HTTP

## 定义

- 超文本是指不同的文本之间可以通过超链接来连接起来，从而形成一个网络。
- HTML，全称超文本标记语言（Hyper Text Markup Language），是超文本的一种实现方式。它使用一系列标签来标记网页中的文本、图片、音频、视频等内容。还创建了网页中的超链接，使得用户可以在不同的信息节点之间自由跳转。
- HTTP，全称超文本传输协议（Hypertext Transfer Protocol），是一种应用层协议，用于在计算机网络中传输超文本。HTTP协议是客户端（通常是浏览器）和服务器之间请求和应答的标准，是互联网上应用最为广泛的一种网络协议。

## HTTP/0.9

- 只支持 get 请求，响应为 html 文档格式的字符串

## HTTP/1.0

- 支持 get、post、head
- 包含基本的头信息、状态码等
- 支持各种数据类型

头信息必须是 ASCII 码，后面的数据可以是任何格式

**缺点：**

1. 一个请求发送一个请求，之后连接就关闭。
2. connection：keep-alive 的设置不是标准字段，不同浏览器的实现不一致

## HTTP/1.1

- tcp 连接默认不关闭
  - 可以被多个请求复用，不用声明 connection：keep-alive，
  - 客户端发现对方一段时间没有活动自动关闭 connection：close。规范的做法是在最后一个请求发送 connection：close
  - 同一个域名，一般允许同时建立**6**个持久连接
- 管道机制
  - 在一个 tcp 连接里，客户端可以同时发送多个请求，不用等前面的收到回应再发送
  - content-length 字段声明本次回应的数据长度，区分数据包
- 分块传输编码
  - transfer-encoding：chunked 表示回应将由数量未定的数据块组成，取代 content-length
  - 数据之前，16 进制数值表示块长度，最后大小为 0 的块表明本次传输完成
- 新的方法例如 put、patch、head、options、delete
- host 头域：将请求发往同一台服务器上的不同网站

**缺点**

- 一个 tcp 连接的通信的服务器回应是按照次序进行的，要是有一个回应特别慢，会发生队头阻塞。

## HTTP/2:基于 SPDY 协议

- **二进制协议**： HTTP/1.1 版的头信息肯定是文本（ASCII 编码），数据体可以是文本，也可以是二进制。HTTP/2 则是一个彻底的二进制协议，头信息和数据体都是二进制。
  - 二进制数据可以直接由计算机硬件处理，而无需像文本格式那样进行复杂的解析，提高解析效率
  - 客户端还可以指定数据流的优先级。优先级越高，服务器就会越早回应。
- **多路复用**
  - **帧**（Frames）：最小的通信单位：这些帧可以是不同类型的，如 HEADERS、DATA、PUSH_PROMISE 等，并且它们可以在单个 TCP 连接上交错发送，**无需等待**其他帧的完成。
  - **流**（Streams）：HTTP/2 通过流来管理这些帧的发送和接收。每个请求或响应都对应一个流，并且每个流都有一个唯一的标识符。多个请求和响应可以在同一个TCP连接上交错发送，而不会相互干扰。从而实现**多路复用**。这意味着即使某个请求因为某种原因被延迟，其他请求也可以继续发送和接收数据，从而大大提高了性能
    -  数据流发送到一半的时候，客户端和服务器都可以发送信号（RST_STREAM帧），取消这个数据流。1.1版取消数据流的唯一方法，就是关闭TCP连接。这就是说，HTTP/2 可以取消某一次请求，同时保证TCP连接还打开着，可以被其他请求使用。
  - **优先级**（Priorities）：HTTP/2 允许客户端为每个流设置优先级。当网络拥塞或服务器资源有限时，服务器可以根据这些优先级来决定先处理哪些流。这有助于确保重要的请求得到优先处理。
- 服务端推送
  - 可以提升首屏加载速度，它允许Web服务器在收到浏览器的请求之前提前发送一些资源给客户端
- 头部压缩
  - 通过HPACK算法有效减少了头部字段的传输大小，提高了网络传输的性能和效率
    - 在客户端和服务器两端建立“字典”，用索引号表示重复的字符串。对于相同的数据，不再通过每次请求和响应发送，而是使用首部表中的引用。这种机制可以大大减少冗余数据的传输，降低开销。
    - 采用哈夫曼编码来压缩整数和字符串，从而达到高压缩率（50%~90%）

参考：

- [HTTP 协议入门](http://www.ruanyifeng.com/blog/2016/08/http.html)
- [理解 HTTP 协议](https://www.cnblogs.com/wxisme/p/6212797.html)
- [深入理解http2.0协议，看这篇就够了！ - 知乎](https://zhuanlan.zhihu.com/p/89471776)
