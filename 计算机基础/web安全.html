<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>web 安全 | 游离 の Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.1cdd1db5.css" as="style"><link rel="preload" href="/assets/js/app.301264ef.js" as="script"><link rel="preload" href="/assets/js/2.491aa157.js" as="script"><link rel="preload" href="/assets/js/93.9f7d7273.js" as="script"><link rel="prefetch" href="/assets/js/10.c14c6624.js"><link rel="prefetch" href="/assets/js/11.a9937c4e.js"><link rel="prefetch" href="/assets/js/12.b046b473.js"><link rel="prefetch" href="/assets/js/13.01aa47ff.js"><link rel="prefetch" href="/assets/js/14.f42daf23.js"><link rel="prefetch" href="/assets/js/15.fb6a03fc.js"><link rel="prefetch" href="/assets/js/16.3d6029c1.js"><link rel="prefetch" href="/assets/js/17.e7fd4a45.js"><link rel="prefetch" href="/assets/js/18.2eee2a30.js"><link rel="prefetch" href="/assets/js/19.c7a805c8.js"><link rel="prefetch" href="/assets/js/20.6ec04b81.js"><link rel="prefetch" href="/assets/js/21.d6a9c37a.js"><link rel="prefetch" href="/assets/js/22.d54975c6.js"><link rel="prefetch" href="/assets/js/23.dd01fe58.js"><link rel="prefetch" href="/assets/js/24.5b080a00.js"><link rel="prefetch" href="/assets/js/25.3e3a8a4d.js"><link rel="prefetch" href="/assets/js/26.530f08ad.js"><link rel="prefetch" href="/assets/js/27.4ff6770f.js"><link rel="prefetch" href="/assets/js/28.4772ab22.js"><link rel="prefetch" href="/assets/js/29.59c92581.js"><link rel="prefetch" href="/assets/js/3.2a78adba.js"><link rel="prefetch" href="/assets/js/30.8945c40e.js"><link rel="prefetch" href="/assets/js/31.71ea1936.js"><link rel="prefetch" href="/assets/js/32.242631cf.js"><link rel="prefetch" href="/assets/js/33.3096cd30.js"><link rel="prefetch" href="/assets/js/34.65f27a2b.js"><link rel="prefetch" href="/assets/js/35.8a5e22fe.js"><link rel="prefetch" href="/assets/js/36.b8444b82.js"><link rel="prefetch" href="/assets/js/37.07333cdf.js"><link rel="prefetch" href="/assets/js/38.c9340582.js"><link rel="prefetch" href="/assets/js/39.86b27506.js"><link rel="prefetch" href="/assets/js/4.6c7e408b.js"><link rel="prefetch" href="/assets/js/40.3e8e0e91.js"><link rel="prefetch" href="/assets/js/41.4abf36b5.js"><link rel="prefetch" href="/assets/js/42.b93937ca.js"><link rel="prefetch" href="/assets/js/43.599a58a3.js"><link rel="prefetch" href="/assets/js/44.58c0ac23.js"><link rel="prefetch" href="/assets/js/45.a007e26f.js"><link rel="prefetch" href="/assets/js/46.9aebcd42.js"><link rel="prefetch" href="/assets/js/47.ac13be33.js"><link rel="prefetch" href="/assets/js/48.34e99078.js"><link rel="prefetch" href="/assets/js/49.195b0aef.js"><link rel="prefetch" href="/assets/js/5.82c6f654.js"><link rel="prefetch" href="/assets/js/50.964a51b7.js"><link rel="prefetch" href="/assets/js/51.b0b85444.js"><link rel="prefetch" href="/assets/js/52.755194bb.js"><link rel="prefetch" href="/assets/js/53.bd98d30b.js"><link rel="prefetch" href="/assets/js/54.51fa13df.js"><link rel="prefetch" href="/assets/js/55.3b27f82c.js"><link rel="prefetch" href="/assets/js/56.2d5f09af.js"><link rel="prefetch" href="/assets/js/57.59e5bf64.js"><link rel="prefetch" href="/assets/js/58.4da215bb.js"><link rel="prefetch" href="/assets/js/59.f0dd1160.js"><link rel="prefetch" href="/assets/js/6.5245781e.js"><link rel="prefetch" href="/assets/js/60.8a3a51dc.js"><link rel="prefetch" href="/assets/js/61.2d221c84.js"><link rel="prefetch" href="/assets/js/62.1efabc55.js"><link rel="prefetch" href="/assets/js/63.fad6ede3.js"><link rel="prefetch" href="/assets/js/64.16603306.js"><link rel="prefetch" href="/assets/js/65.fa49138c.js"><link rel="prefetch" href="/assets/js/66.881a3bb5.js"><link rel="prefetch" href="/assets/js/67.25cbb4cf.js"><link rel="prefetch" href="/assets/js/68.117eca53.js"><link rel="prefetch" href="/assets/js/69.053855dc.js"><link rel="prefetch" href="/assets/js/7.fc1bdbb6.js"><link rel="prefetch" href="/assets/js/70.7721e7e9.js"><link rel="prefetch" href="/assets/js/71.29a557ad.js"><link rel="prefetch" href="/assets/js/72.1a6f90ae.js"><link rel="prefetch" href="/assets/js/73.913d468a.js"><link rel="prefetch" href="/assets/js/74.96968d72.js"><link rel="prefetch" href="/assets/js/75.01b38a33.js"><link rel="prefetch" href="/assets/js/76.f82ae778.js"><link rel="prefetch" href="/assets/js/77.68514817.js"><link rel="prefetch" href="/assets/js/78.56b87e13.js"><link rel="prefetch" href="/assets/js/79.9ac9d757.js"><link rel="prefetch" href="/assets/js/8.f060be44.js"><link rel="prefetch" href="/assets/js/80.6090f235.js"><link rel="prefetch" href="/assets/js/81.7de2f01b.js"><link rel="prefetch" href="/assets/js/82.1b7be951.js"><link rel="prefetch" href="/assets/js/83.1104bfb5.js"><link rel="prefetch" href="/assets/js/84.7e0dbb84.js"><link rel="prefetch" href="/assets/js/85.abb461ec.js"><link rel="prefetch" href="/assets/js/86.2e77efbc.js"><link rel="prefetch" href="/assets/js/87.b93727f5.js"><link rel="prefetch" href="/assets/js/88.b554117b.js"><link rel="prefetch" href="/assets/js/89.c1306298.js"><link rel="prefetch" href="/assets/js/9.18126abf.js"><link rel="prefetch" href="/assets/js/90.328f05cd.js"><link rel="prefetch" href="/assets/js/91.8008e0b0.js"><link rel="prefetch" href="/assets/js/92.8b4dca37.js"><link rel="prefetch" href="/assets/js/94.176890d0.js"><link rel="prefetch" href="/assets/js/95.a69dbea6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1cdd1db5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">游离 の Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dev Ops</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/计算机基础/web安全.html" class="active sidebar-link">web 安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#点击劫持-clickjacking" class="sidebar-link">点击劫持(clickjacking)</a></li><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#csrf" class="sidebar-link">CSRF</a></li><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#xss" class="sidebar-link">XSS</a></li><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#dom-型-xss-前端取出url中的恶意代码执行-通过修改页面的-dom-节点形成的-xss-称为-dom-based-xss" class="sidebar-link">Dom 型 XSS：前端取出URL中的恶意代码执行，通过修改页面的 dom 节点形成的 XSS，称为 dom based XSS</a></li><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/计算机基础/web安全.html#csp-content-security-policy-内容安全策略检查" class="sidebar-link">CSP（Content Security Policy）内容安全策略检查</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web-安全"><a href="#web-安全" class="header-anchor">#</a> web 安全</h1> <h2 id="点击劫持-clickjacking"><a href="#点击劫持-clickjacking" class="header-anchor">#</a> 点击劫持(clickjacking)</h2> <p>原理：攻击者使用透明的 iframe 覆盖在网页上，诱使用户在点击，</p> <ol><li>flash 点击劫持：用过 flash 游戏，让用户完成一系列复杂的操作</li> <li>图片覆盖攻击 Cross Site Image Overlaying（XSIO）</li></ol> <p>防护：</p> <ul><li><strong>X-Frame-Options</strong> <ul><li>X-Frame-Options HTTP 响应头是用来给浏览器指示允许一个页面可否在 &lt;frame&gt;, &lt;iframe&gt;或者 &lt;object&gt; 中展现的标记。网站可以使用此功能，来确保自己网站的内容没有被嵌到别人的网站中去，也从而避免了点击劫持 的攻击。</li></ul></li></ul> <h2 id="csrf"><a href="#csrf" class="header-anchor">#</a> <a href="https://juejin.im/post/5ce55b3d5188253386140dd0#heading-4" target="_blank" rel="noopener noreferrer">CSRF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>CSRF(Cross Site Request Forgery)指的是跨站请求伪造</p> <p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止CSRF攻击？ - 美团技术团队<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <ul><li>在受骗者已经登录对应网站生成 cookie 后，攻击者做一个网站让受骗者点击，这时受骗者的 cookie 还在，那么这个构造的网站就能够利用受骗者的 cookie 执行网站恶意请求</li> <li>CSRF 攻击是黑客借助受害者的 cookie 骗取服务器的信任，但是黑客并不能拿到 cookie，也看不到 cookie 的内容</li></ul> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <ol><li>发生在第三方域名</li> <li>不能获取到 cookie 只是借用（在请求参数中加上 cookie 并让服务器验证），但是跨域请求拿不到 cookie</li></ol> <h3 id="攻击方式"><a href="#攻击方式" class="header-anchor">#</a> 攻击方式</h3> <p>由于 AJAX 是不支持跨域发送请求的，所以我们只能够用支持跨域请求的 img、script、form 表单来发起请求，这些请求的限制性很强</p> <ol><li>通过 img\iframe\script 发起 get 请求
<ul><li>由于 get 请求只能获取信息，不会修改数据库中信息，所以一般 get 请求伪造的影响较小。</li></ul></li> <li>通过 js 提交 form 表单发起 post 请求
<ul><li>post 请求一般是通过表单发送，而表单请求不能修改请求头，也不能带上 query，所以这就是 token 防止 csrf 的原因</li></ul></li></ol> <h3 id="防护"><a href="#防护" class="header-anchor">#</a> <a href="https://zhuanlan.zhihu.com/p/40588156" target="_blank" rel="noopener noreferrer">防护<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>根据CSRF的特点我们有以下防护措施</p> <ol><li>校验请求来源
<ol><li>阻止不明请求
<ol><li><a href="https://blog.csdn.net/sinat_36521655/article/details/104844667" target="_blank" rel="noopener noreferrer">设置cookies的sameSite属性的值为strict或者lax<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ol><li>这样只有同源网站的请求才会带上cookies。</li></ol></li> <li>同源检测
<ol><li>根据Origin限制跨域请求</li> <li>限制<a href="https://www.ruanyifeng.com/blog/2019/06/http-referer.html" target="_blank" rel="noopener noreferrer">referer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：把Referrer Policy的策略设置成same-origin 可通过CSP</li></ol></li></ol></li> <li>请求时要求附加本域才能获取的信息
<ol><li>验证csrf token：服务端随机生成token，保存在服务端session中，同时保存到客户端中，客户端发送请求时，把token带到HTTP请求头或参数中，服务端接收到请求，验证请求中的token与session中的是否一致。
<ol><li>前后端不分离：token可以直接在编译模板的过程中写到表单的隐藏字段中，这样发送请求不需要额外的操作；</li> <li>前后端分离：双重cookie校验
<ol><li>token可以在登录时写入到cookies中，发送请求时，js读取cookies中的token，并设置到HTTP请求头中。
axios有相关配置如下
<img src="https://picx.zhimg.com/80/v2-7ea9e31f1d90b2eb816e93d680e6e82b_720w.webp?source=1940ef5c" alt="img"></li></ol></li></ol></li></ol></li> <li>保证网络请求由真实用户发出
<ul><li>用户操作限制（验证码）</li></ul></li></ol></li> <li>不使用cookie，使用token校验用户身份，换用token标识用户身份，放到请求头里面</li></ol> <h2 id="xss"><a href="#xss" class="header-anchor">#</a> <a href="https://juejin.cn/post/6844903685122703367#heading-13" target="_blank" rel="noopener noreferrer">XSS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>Cross-site scripting，跨站脚本攻击。HTMl 注入插入恶意脚本，篡改网页，在用户浏览网页时，控制用户浏览器的一种攻击</p> <p><a href="https://tsejx.github.io/javascript-guidebook/computer-networks/web-security/xss/#%E9%98%B2%E5%BE%A1%E7%AD%96%E7%95%A5" target="_blank" rel="noopener noreferrer">XSS 跨站脚本攻击 - JavaScript Guidebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/leizongmin/js-xss/blob/master/README.zh.md" target="_blank" rel="noopener noreferrer">js-xss/README.zh.md at master · leizongmin/js-xss<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>主要经过以下两个步骤</p> <ol><li>攻击者提交恶意代码。</li> <li>浏览器执行恶意代码。</li></ol> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <ol><li>存储型 XSS：也叫持久性 XSS，恶意代码提交到<code>服务器端</code>中，<code>服务端</code>拼接 html 返回，再在前端解析执行。
<ol><li><strong>常见于评论、私信、发博客</strong>。所有查看了该博客该评论的用户，都会执行这段恶意脚本</li> <li>XSS 蠕虫：<strong>在恶意脚本中利用用户的登录状态进行关注、发微博、发私信等操作</strong>，发出的微博和私信可再带上攻击 URL，诱导更多人点击，不断放大攻击范围。这种窃用受害者身份发布恶意内容，层层放大攻击范围的方式，被称为“XSS 蠕虫”。</li></ol></li> <li>反射性XSS：也叫非持久性 XSS，输入恶意代码，通过<code>URL</code>提交执行，<code>服务端</code>取出恶意代码，拼接在 html 时返回，浏览器请求再执行恶意代码。
<ol><li>出现于前后端未分离的项目，后端控制前端渲染的情况下才会出现，如果是前后端分离的情况则属于DOM型XSS</li> <li>常见于 <strong>通过 URL 传递参数</strong> 的功能，如网站搜索、跳转等</li></ol></li> <li><h2 id="dom-型-xss-前端取出url中的恶意代码执行-通过修改页面的-dom-节点形成的-xss-称为-dom-based-xss"><a href="#dom-型-xss-前端取出url中的恶意代码执行-通过修改页面的-dom-节点形成的-xss-称为-dom-based-xss" class="header-anchor">#</a> Dom 型 XSS：<code>前端</code>取出<code>URL</code>中的恶意代码执行，通过修改页面的 dom 节点形成的 XSS，称为 dom based XSS</h2></li></ol> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>防范 XSS 是需要后端 RD 和前端 RD 共同参与的系统工程。
<ul><li>存储型和反射型由于代码是存储到服务端的，需要服务端做xss防范</li> <li>而DOM型是纯前端获取与展示，需要前端做xss防范</li></ul></li> <li>转义应该在输出 HTML 时进行，而不是在提交用户输入时。</li></ul> <h3 id="攻击方式-2"><a href="#攻击方式-2" class="header-anchor">#</a> 攻击方式</h3> <ul><li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li> <li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li> <li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li> <li>在标签的 href、src 等属性中，包含 javascript: 等可执行代码。</li> <li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li> <li>在 style 属性和标签中，包含类似 background-image:url(&quot;javascript:…&quot;); 的代码（新版本浏览器已经可以防范）。</li> <li>在 style 属性和标签中，包含类似 expression(…) 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li></ul> <h3 id="危害"><a href="#危害" class="header-anchor">#</a> 危害</h3> <ol><li>document.cookie 获取 cookie 实现 cookie 劫持，可以通过绑定 IP 防御</li> <li>通过动态插入 img，在 src 赋值上构造 get 请求构造 get 请求</li> <li>通过动态添加 post 请求的 form 标签，构造 post 请求</li> <li>也可以直接通过 ajax 请求发送构造请求</li></ol> <h3 id="预防"><a href="#预防" class="header-anchor">#</a> 预防</h3> <ul><li>输入过滤（输入侧过滤能够在某些情况下解决特定的 XSS 问题，但会引入很大的不确定性和乱码问题。在防范 XSS 攻击时应避免此类方法。）
<ul><li>输入侧过滤能够在某些情况下解决特定的 XSS 问题，但会引入很大的不确定性和乱码问题。在防范 XSS 攻击时应避免此类方法。 当然，对于明确的输入类型，例如数字、URL、电话号码、邮件地址等等内容，进行输入过滤还是必要的</li></ul></li> <li>转义 HTML
<ul><li>不同的上下文，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致。 业务 RD 需要选取合适的转义库，并针对不同的上下文调用不同的转义规则。</li></ul></li> <li>设置 cookie的httponly 缓解 xss，可以通过 trace 请求读取 httponly cookie</li> <li>预防 DOM 型 XSS 攻击：避免使用 DOM 中的内联事件监听器，</li> <li>使用 CSP</li></ul> <h2 id="csp-content-security-policy-内容安全策略检查"><a href="#csp-content-security-policy-内容安全策略检查" class="header-anchor">#</a> <a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer">CSP（Content Security Policy）内容安全策略检查<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <ul><li><p>&quot;网页安全政策&quot;， CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单</p></li> <li><p>如果只允许加载自己域的图片，可以 加上这个 meta 标签<code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;img-src 'self';&quot;&gt;</code></p></li> <li><p><code>Content-Security-Policy: script-src 'self'</code></p></li> <li><p><code>Content-Security-Policy: default-src 'self'</code></p></li> <li><p>或者后端设置这个 http 响应头，self 表示本域，如果加载其他域的图片浏览器会报错</p></li> <li><p><img src="https://pic4.zhimg.com/v2-bf28b28cd47bbab12b052811d52a1223_b.jpg" alt="image"></p></li> <li><div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Content-Security-Policy:</span> script-src 'self'; object-src 'none';
style-src cdn.example.org third-party.org; child-src https:
</code></pre></div><ul><li>脚本：只信任当前域名</li> <li><code>&lt;object&gt;</code>标签：不信任任何 URL，即不加载任何资源</li> <li>样式表：只信任<code>cdn.example.org</code>和<code>third-party.org</code></li> <li>框架（frame）：必须使用 HTTPS 协议加载</li> <li>其他资源：没有限制</li></ul> <p>参考：<a href="https://www.cnblogs.com/heyuqing/p/6215761.html" target="_blank" rel="noopener noreferrer">前端安全配置之 Content-Security-Policy(csp)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vuepress/edit/master/计算机基础/web安全.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/30/2023, 7:22:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/网络/grpc.html" class="prev">
        grpc
      </a></span> <span class="next"><a href="/编程/函数式编程.html">
        函数式编程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.301264ef.js" defer></script><script src="/assets/js/2.491aa157.js" defer></script><script src="/assets/js/93.9f7d7273.js" defer></script>
  </body>
</html>
